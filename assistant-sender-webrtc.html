<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Ï°∞ÏàòÏö© ÏÜ°Ïã† Ïï± - WebRTC</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      touch-action: none;
      overflow: hidden;
    }
    body.fullscreen-mode {
      background: #000;
      padding: 0;
    }
    .container { max-width: 600px; margin: 0 auto; transition: all 0.5s ease; }
    .container.fullscreen { max-width: 100%; margin: 0; }
    
    /* Ïó∞Í≤∞ ÏÉÅÌÉú Ìó§Îçî */
    .header {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: all 0.5s ease;
    }
    .header.hidden { 
      display: none;
    }
    .header h1 { font-size: 24px; color: #333; margin-bottom: 15px; }
    
    .connection-box {
      background: #f8f9fa;
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
    }
    .connection-code {
      text-align: center;
      padding: 15px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 10px;
      margin-bottom: 10px;
    }
    .code-label {
      color: white;
      font-size: 14px;
      opacity: 0.9;
      margin-bottom: 5px;
    }
    .code-value {
      color: white;
      font-size: 36px;
      font-weight: bold;
      letter-spacing: 8px;
      font-family: 'Courier New', monospace;
    }
    
    .connection-status {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 12px;
      background: white;
      border-radius: 8px;
    }
    .status-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: #ccc;
      transition: all 0.3s ease;
    }
    .status-dot.waiting { background: #ffa500; box-shadow: 0 0 10px #ffa500; animation: blink 1.5s infinite; }
    .status-dot.connected { background: #00ff00; box-shadow: 0 0 10px #00ff00; animation: pulse 2s infinite; }
    .status-text { font-size: 14px; color: #666; flex: 1; }
    
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
    
    .network-guide {
      background: #e3f2fd;
      border-left: 4px solid #2196f3;
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      color: #1976d2;
      line-height: 1.6;
    }

    /* Ï∫îÎ≤ÑÏä§ ÏòÅÏó≠ */
    .canvas-container {
      background: white;
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: all 0.5s ease;
    }
    .canvas-container.fullscreen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      border-radius: 0;
      padding: 0;
      margin: 0;
      background: #1a3a1a;
      z-index: 1000;
    }
    .canvas-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      transition: all 0.5s ease;
    }
    .canvas-header.hidden {
      display: none;
    }
    .canvas-header h2 { font-size: 18px; color: #333; }
    .tool-buttons { display: flex; gap: 10px; }
    .tool-btn {
      padding: 8px 15px;
      background: #f5f5f5;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
      user-select: none;
    }
    .tool-btn:active { transform: scale(0.95); }
    .tool-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    #canvas {
      display: block;
      width: 100%;
      height: 400px;
      border: 2px solid #ddd;
      border-radius: 8px;
      touch-action: none;
      cursor: crosshair;
      background: #000 url('data:image/webp;base64,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') center/cover no-repeat;
      box-shadow:
        inset 0 0 80px rgba(0,0,0,0.4),
        inset 10px 0 40px rgba(0,0,0,0.3),
        inset -10px 0 40px rgba(0,0,0,0.3);
      transition: all 0.5s ease;
    }
    .canvas-container.fullscreen #canvas {
      width: 100vw;
      height: calc(100vh - 80px); /* Î≤ÑÌäº ÏòÅÏó≠(70px) + Ïó¨Ïú†(10px) */
      border: none;
      border-radius: 0;
    }

    /* Ïï°ÏÖò Î≤ÑÌäº */
    .action-buttons { 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 15px;
      transition: all 0.5s ease;
    }
    .action-buttons.hidden {
      display: none;
    }
    .action-buttons.fullscreen {
      position: fixed;
      bottom: 10px;
      left: 10px;
      right: 10px;
      z-index: 1001;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      opacity: 0.85;
      pointer-events: auto;
    }
    .action-btn {
      padding: 18px;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
      user-select: none;
      touch-action: manipulation;
    }
    .action-buttons.fullscreen .action-btn {
      padding: 10px 18px;
      font-size: 14px;
      border-radius: 8px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.4);
    }
    .action-btn:active { transform: translateY(2px); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .clear-btn { background: #ff6b6b; color: white; }
    .send-btn { background: #51cf66; color: white; }
    .send-btn:disabled { background: #ccc; cursor: not-allowed; }

    /* ÏÉÅÌÉú Î©îÏãúÏßÄ */
    .status-message {
      background: white;
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      margin-top: 20px;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.3s ease;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2000;
      min-width: 300px;
      pointer-events: none; /* Ïà®Í≤®Ï°åÏùÑ Îïå ÌÑ∞Ïπò Î∞©Ìï¥ Ïïà Ìï® */
    }
    .status-message.show { 
      opacity: 1; 
      transform: translate(-50%, -50%);
      pointer-events: auto; /* Î≥¥Ïùº ÎïåÎßå ÌÑ∞Ïπò Í∞ÄÎä• */
    }
    .status-message.success { background: linear-gradient(135deg, #51cf66, #37b24d); color: white; }
    .status-message.error { background: linear-gradient(135deg, #ff6b6b, #fa5252); color: white; }
    .status-message.sending { background: linear-gradient(135deg, #4c6ef5, #3b5bdb); color: white; }
    .status-icon { font-size: 48px; margin-bottom: 10px; }
    .status-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
    .status-description { font-size: 14px; opacity: 0.9; }
  </style>
</head>
<body>
  <div class="container">
    <!-- Ïó∞Í≤∞ ÏÉÅÌÉú Ìó§Îçî -->
    <div class="header">
      <h1>üé© Ï°∞ÏàòÏö© ÏÜ°Ïã† Ïï±</h1>
      
      <div class="connection-box">
        <div class="connection-code">
          <div class="code-label">Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÏóê ÏûÖÎ†•Ìï† ÏΩîÎìú</div>
          <div class="code-value" id="connectionCode">------</div>
        </div>
        
        <div class="connection-status">
          <div class="status-dot" id="statusDot"></div>
          <span class="status-text" id="statusText">Ïó∞Í≤∞ Ï§ÄÎπÑ Ï§ë...</span>
        </div>
      </div>
      
      <div class="network-guide">
        üí° <strong>ÏÇ¨Ïö© Î∞©Î≤ï:</strong><br>
        1. Ìï´Ïä§Ìåü ÏºúÍ±∞ÎÇò Í∞ôÏùÄ Wi-FiÏóê Ïó∞Í≤∞<br>
        2. Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÏóêÏÑú ÏúÑ ÏΩîÎìú ÏûÖÎ†•<br>
        3. Ïó∞Í≤∞ÎêòÎ©¥ ÏÜêÍ∏ÄÏî® Ï†ÑÏÜ° Í∞ÄÎä•!
      </div>
    </div>

    <!-- Ï∫îÎ≤ÑÏä§ ÏòÅÏó≠ -->
    <div class="canvas-container">
      <div class="canvas-header">
        <h2>‚úèÔ∏è ÏÜêÍ∏ÄÏî®Î°ú Ï†ÅÍ∏∞</h2>
        <div class="tool-buttons">
          <button class="tool-btn active" data-tool="pen" onclick="selectTool('pen')">Ìù∞ Î∂ÑÌïÑ</button>
          <button class="tool-btn" data-tool="thick" onclick="selectTool('thick')">ÍµµÍ≤å</button>
          <button class="tool-btn" data-tool="eraser" onclick="selectTool('eraser')">ÏßÄÏö∞Í∞ú</button>
        </div>
      </div>
      <canvas id="canvas"></canvas>
    </div>

    <!-- Ïï°ÏÖò Î≤ÑÌäº -->
    <div class="action-buttons">
      <button class="action-btn clear-btn" onclick="clearCanvas()">üóëÔ∏è ÏßÄÏö∞Í∏∞</button>
      <button class="action-btn send-btn" id="sendBtn" onclick="sendHandwriting()" disabled>üì§ Ï†ÑÏÜ°ÌïòÍ∏∞</button>
    </div>

    <!-- ÏÉÅÌÉú Î©îÏãúÏßÄ -->
    <div class="status-message" id="statusMessage">
      <div class="status-icon" id="statusIcon"></div>
      <div class="status-title" id="statusTitle"></div>
      <div class="status-description" id="statusDescription"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
  <script>
    // Ïó∞Í≤∞ ÏΩîÎìú ÏÉùÏÑ±
    function generateCode() {
      const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Ìó∑Í∞àÎ¶¨Îäî Î¨∏Ïûê Ï†úÏô∏
      let code = '';
      for (let i = 0; i < 6; i++) {
        code += chars[Math.floor(Math.random() * chars.length)];
      }
      return code;
    }

    const myCode = 'SENDER-' + generateCode();
    document.getElementById('connectionCode').textContent = myCode.replace('SENDER-', '');

    // PeerJS Ï¥àÍ∏∞Ìôî
    let peer = null;
    let connection = null;
    let isConnected = false;

    try {
      peer = new Peer(myCode, {
        config: {
          iceServers: [
            { urls: 'stun:stun.l.google.com:19302' },
            { urls: 'stun:stun1.l.google.com:19302' }
          ]
        }
      });

      peer.on('open', (id) => {
        console.log('Peer Ï§ÄÎπÑ ÏôÑÎ£å:', id);
        document.getElementById('statusText').textContent = 'Î¨¥ÎåÄ ÏïÑÏù¥Ìå®Îìú Ïó∞Í≤∞ ÎåÄÍ∏∞ Ï§ë...';
        document.getElementById('statusDot').classList.add('waiting');
        showStatus('success', '‚úì', 'Ï§ÄÎπÑ ÏôÑÎ£å!', 'Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÏóêÏÑú ÏΩîÎìúÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî');
      });

      peer.on('connection', (conn) => {
        connection = conn;
        console.log('Ïó∞Í≤∞ ÏãúÎèÑ Í∞êÏßÄ');

        conn.on('open', () => {
          isConnected = true;
          document.getElementById('statusText').textContent = 'Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÏôÄ Ïó∞Í≤∞Îê® ‚úì';
          document.getElementById('statusDot').classList.remove('waiting');
          document.getElementById('statusDot').classList.add('connected');
          document.getElementById('sendBtn').disabled = false;
          showStatus('success', 'üéâ', 'Ïó∞Í≤∞ ÏÑ±Í≥µ!', 'Ïù¥Ï†ú ÏÜêÍ∏ÄÏî®Î•º Ï†ÑÏÜ°Ìï† Ïàò ÏûàÏäµÎãàÎã§');
          
          // 2Ï¥à ÌõÑ Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®ÎìúÎ°ú Ï†ÑÌôò
          setTimeout(() => {
            enterFullscreenMode();
          }, 2000);
        });

        conn.on('close', () => {
          isConnected = false;
          document.getElementById('statusText').textContent = 'Ïó∞Í≤∞ ÎÅäÍπÄ - Ïû¨Ïó∞Í≤∞ ÎåÄÍ∏∞ Ï§ë...';
          document.getElementById('statusDot').classList.remove('connected');
          document.getElementById('statusDot').classList.add('waiting');
          document.getElementById('sendBtn').disabled = true;
          showStatus('error', '‚ö†Ô∏è', 'Ïó∞Í≤∞ ÎÅäÍπÄ', 'Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî');
        });

        conn.on('error', (err) => {
          console.error('Ïó∞Í≤∞ Ïò§Î•ò:', err);
        });
      });

      peer.on('error', (err) => {
        console.error('Peer Ïò§Î•ò:', err);
        showStatus('error', '‚ùå', 'Ïò§Î•ò Î∞úÏÉù', err.message);
      });

    } catch (error) {
      console.error('PeerJS Ï¥àÍ∏∞Ìôî Ïò§Î•ò:', error);
      showStatus('error', '‚ùå', 'Ï¥àÍ∏∞Ìôî Ïã§Ìå®', error.message);
    }

    // Ï∫îÎ≤ÑÏä§ ÏÑ§Ï†ï
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: false });
    let isDrawing = false;
    let currentTool = 'pen';
    let lastPos = null;
    let lastTime = 0;

    const chalk = {
      baseWidth: 15,
      thickWidth: 22,
      density: 40,
      spread: 0.1,
      roughness: 0.9
    };

    function rand(min, max) { return Math.random() * (max - min) + min; }
    function clamp(v, a, b) { return Math.max(a, Math.min(b, v)); }

    function setupCanvas() {
      const rect = canvas.getBoundingClientRect();
      
      // Ïã§Ï†ú Î†åÎçîÎßÅÎêú ÌÅ¨Í∏∞Î°ú Ï∫îÎ≤ÑÏä§ ÏÑ§Ï†ï
      canvas.width = Math.floor(rect.width);
      canvas.height = Math.floor(rect.height);
      
      // Î≥ÄÌôò Ï¥àÍ∏∞Ìôî
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      
      // Ï∫îÎ≤ÑÏä§Î•º Ìà¨Î™ÖÌïòÍ≤å Ï¥àÍ∏∞Ìôî
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      console.log('Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞:', canvas.width, 'x', canvas.height);
      console.log('CSS ÌÅ¨Í∏∞:', rect.width, 'x', rect.height);
    }

    setupCanvas();
    window.addEventListener('resize', setupCanvas);

    window.selectTool = function(tool) {
      currentTool = tool;
      document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`[data-tool="${tool}"]`).classList.add('active');
    };

    function getPosition(e) {
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      
      // ÌÑ∞Ïπò ÏúÑÏπò Í≥ÑÏÇ∞
      const x = clientX - rect.left;
      const y = clientY - rect.top;
      
      return { x, y };
    }

    function calcSpeed(p, t) {
      if (!lastPos) return 0.5;
      const dx = p.x - lastPos.x;
      const dy = p.y - lastPos.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      const dt = Math.max(1, t - lastTime);
      return dist / dt;
    }

    function drawChalkParticles(x, y, w, speed) {
      const baseCount = (currentTool === 'thick') ? chalk.density * 1.5 : chalk.density;
      const count = Math.floor(baseCount * (1 + speed * 0.3));
      
      ctx.save();
      ctx.globalCompositeOperation = 'source-over';
      
      for (let i = 0; i < count; i++) {
        const u1 = Math.random();
        const u2 = Math.random();
        const gaussian = Math.sqrt(-2 * Math.log(u1)) * Math.cos(2 * Math.PI * u2);
        
        const spreadX = gaussian * w * chalk.spread * rand(0.35, 0.65);
        const spreadY = gaussian * w * chalk.spread * rand(0.35, 0.65);
        
        const px = x + spreadX;
        const py = y + spreadY;
        
        const distFromCenter = Math.sqrt(spreadX*spreadX + spreadY*spreadY);
        const maxDist = w * chalk.spread;
        const alphaFalloff = 1 - clamp(distFromCenter / maxDist, 0, 0.7);
        
        const size = rand(0.3, 2.0) * (currentTool === 'thick' ? 1.4 : 1.0);
        const baseAlpha = rand(0.15, 0.35) * alphaFalloff;
        
        const r = 230 + rand(-8, 5);
        const g = 235 + rand(-12, 6);
        const b = 228 + rand(-10, 8);
        
        ctx.fillStyle = `rgba(${r|0}, ${g|0}, ${b|0}, ${baseAlpha})`;
        
        if (Math.random() > 0.3) {
          ctx.beginPath();
          ctx.arc(px, py, size, 0, Math.PI * 2);
          ctx.fill();
        } else {
          ctx.fillRect(px - size/2, py - size/2, size * rand(0.8, 1.3), size * rand(0.8, 1.3));
        }
      }
      
      ctx.restore();
    }

    function startDrawing(e) {
      isDrawing = true;
      const pos = getPosition(e);
      lastPos = pos;
      lastTime = Date.now();
      
      if (currentTool !== 'eraser') {
        const w = (currentTool === 'thick') ? chalk.thickWidth : chalk.baseWidth;
        drawChalkParticles(pos.x, pos.y, w, 0);
      }
    }

    function draw(e) {
      if (!isDrawing) return;
      
      const pos = getPosition(e);
      const now = Date.now();
      
      if (currentTool === 'eraser') {
        ctx.save();
        ctx.globalCompositeOperation = 'destination-out';
        ctx.lineWidth = 40;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(lastPos.x, lastPos.y);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        ctx.restore();
        lastPos = pos;
        lastTime = now;
        return;
      }
      
      const speed = calcSpeed(pos, now);
      const w = (currentTool === 'thick') ? chalk.thickWidth : chalk.baseWidth;
      
      const dx = pos.x - lastPos.x;
      const dy = pos.y - lastPos.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      const steps = Math.max(1, Math.floor(dist / 2));
      
      for (let i = 0; i <= steps; i++) {
        const t = i / steps;
        const ix = lastPos.x + dx * t;
        const iy = lastPos.y + dy * t;
        
        const jitterX = rand(-chalk.roughness, chalk.roughness);
        const jitterY = rand(-chalk.roughness, chalk.roughness);
        
        drawChalkParticles(ix + jitterX, iy + jitterY, w, speed);
      }
      
      lastPos = pos;
      lastTime = now;
    }

    function stopDrawing() {
      isDrawing = false;
      lastPos = null;
      lastTime = 0;
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDrawing(e); }, { passive: false });
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); }, { passive: false });
    canvas.addEventListener('touchend', (e) => { e.preventDefault(); stopDrawing(); }, { passive: false });

    window.clearCanvas = function() {
      const rect = canvas.getBoundingClientRect();
      ctx.clearRect(0, 0, rect.width, rect.height);
      showStatus('success', 'üßΩ', 'ÏßÄÏõÄ ÏôÑÎ£å', 'Ïπ†ÌåêÏù¥ Íπ®ÎÅóÌï¥Ï°åÏäµÎãàÎã§');
    };

    window.sendHandwriting = function() {
      if (!isConnected || !connection) {
        showStatus('error', '‚ùå', 'Ïó∞Í≤∞ ÏïàÎê®', 'Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÏôÄ Ïó∞Í≤∞ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî');
        return;
      }
      
      showStatus('sending', 'üì§', 'Ï†ÑÏÜ°Ï§ë...', 'ÏÜêÍ∏ÄÏî®Î•º Î¨¥ÎåÄÎ°ú Î≥¥ÎÇ¥Í≥† ÏûàÏäµÎãàÎã§');
      
      try {
        // ÏÜêÍ∏ÄÏî®Îßå PNGÎ°ú Ï†ÑÏÜ° (Î∞∞Í≤Ω Ìà¨Î™Ö)
        const imageData = canvas.toDataURL('image/png', 1.0);
        connection.send({
          type: 'handwriting',
          image: imageData,
          timestamp: Date.now()
        });
        
        console.log('ÏÜêÍ∏ÄÏî® Ï†ÑÏÜ° ÏôÑÎ£å');
        showStatus('success', '‚úì', 'Ï†ÑÏÜ° ÏôÑÎ£å!', 'Î¨¥ÎåÄ ÏïÑÏù¥Ìå®ÎìúÍ∞Ä ÏÜêÍ∏ÄÏî®Î•º ÏàòÏã†Ìï©ÎãàÎã§');
      } catch (error) {
        console.error('Ï†ÑÏÜ° Ïò§Î•ò:', error);
        showStatus('error', '‚ùå', 'Ï†ÑÏÜ° Ïã§Ìå®', error.message);
      }
    };

    function showStatus(type, icon, title, description) {
      const statusMessage = document.getElementById('statusMessage');
      const statusIcon = document.getElementById('statusIcon');
      const statusTitle = document.getElementById('statusTitle');
      const statusDescription = document.getElementById('statusDescription');
      statusMessage.className = `status-message show ${type}`;
      statusIcon.textContent = icon;
      statusTitle.textContent = title;
      statusDescription.textContent = description;
      setTimeout(() => statusMessage.classList.remove('show'), 3000);
    }

    // Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú ÏßÑÏûÖ
    function enterFullscreenMode() {
      document.body.classList.add('fullscreen-mode');
      document.querySelector('.container').classList.add('fullscreen');
      document.querySelector('.header').classList.add('hidden');
      document.querySelector('.canvas-header').classList.add('hidden');
      document.querySelector('.canvas-container').classList.add('fullscreen');
      document.querySelector('.action-buttons').classList.add('fullscreen');
      
      // Ï†ÑÏ≤¥ÌôîÎ©¥ Ï†ÑÌôò ÌõÑ Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ïû¨Ï°∞Ï†ï (Ïï†ÎãàÎ©îÏù¥ÏÖò ÏôÑÎ£å ÌõÑ)
      setTimeout(() => {
        setupCanvas();
        console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú ÏßÑÏûÖ - Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ïû¨Ï°∞Ï†ï ÏôÑÎ£å');
      }, 600);
    }

    // Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú Ìï¥Ï†ú (ÌïÑÏöîÏãú)
    function exitFullscreenMode() {
      document.body.classList.remove('fullscreen-mode');
      document.querySelector('.container').classList.remove('fullscreen');
      document.querySelector('.header').classList.remove('hidden');
      document.querySelector('.canvas-header').classList.remove('hidden');
      document.querySelector('.canvas-container').classList.remove('fullscreen');
      document.querySelector('.action-buttons').classList.remove('fullscreen');
      
      // Ï∫îÎ≤ÑÏä§ ÌÅ¨Í∏∞ Ïû¨Ï°∞Ï†ï
      setupCanvas();
      console.log('Ï†ÑÏ≤¥ÌôîÎ©¥ Î™®Îìú Ìï¥Ï†ú');
    }
  </script>
</body>
</html>
